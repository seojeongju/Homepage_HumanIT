<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>관리자 대시보드 - (주)휴먼아이티</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"/>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <!-- 모바일 오버레이 -->
        <div id="sidebarOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>
        
        <!-- 사이드바 -->
        <aside id="sidebar" class="fixed lg:static inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 w-64 bg-gradient-to-b from-blue-600 to-purple-600 text-white z-50 transition-transform duration-300 ease-in-out">
            <div class="p-6">
                <!-- 모바일 닫기 버튼 -->
                <div class="lg:hidden flex justify-end mb-4">
                    <button id="closeSidebar" class="text-white hover:bg-white/10 p-2 rounded-lg">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="flex items-center space-x-3 mb-8">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                        <i class="fas fa-user-shield text-blue-600"></i>
                    </div>
                    <div>
                        <h2 class="font-bold">관리자</h2>
                        <p class="text-xs text-blue-200" id="adminUsername">-</p>
                    </div>
                </div>

                <nav class="space-y-2">
                    <a href="/admin/dashboard.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-white/20 hover:bg-white/30 transition">
                        <i class="fas fa-tachometer-alt w-5"></i>
                        <span>대시보드</span>
                    </a>
                    <a href="/admin/notice.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <i class="fas fa-bullhorn w-5"></i>
                        <span>공지사항</span>
                    </a>
                    <a href="/admin/download.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <i class="fas fa-download w-5"></i>
                        <span>자료실</span>
                    </a>
                    <a href="/admin/faq.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <i class="fas fa-question-circle w-5"></i>
                        <span>FAQ</span>
                    </a>
                    <a href="/admin/gallery.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition">
                        <i class="fas fa-images w-5"></i>
                        <span>갤러리</span>
                    </a>
                </nav>

                <div class="mt-8 pt-8 border-t border-white/20">
                    <button onclick="confirmLogout()" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-red-500/20 transition w-full text-left">
                        <i class="fas fa-sign-out-alt w-5"></i>
                        <span>로그아웃</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- 메인 컨텐츠 -->
        <main class="flex-1 overflow-y-auto w-full">
            <!-- 헤더 -->
            <header class="bg-white shadow-sm sticky top-0 z-30">
                <div class="px-4 lg:px-8 py-4 lg:py-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <!-- 모바일 햄버거 메뉴 -->
                            <button id="openSidebar" class="lg:hidden text-gray-700 hover:text-blue-600 p-2">
                                <i class="fas fa-bars text-2xl"></i>
                            </button>
                            <div>
                                <h1 class="text-xl lg:text-2xl font-bold text-gray-900">대시보드</h1>
                                <p class="text-gray-500 mt-1 text-sm lg:text-base hidden sm:block">휴먼아이티 관리자 시스템</p>
                            </div>
                        </div>
                        <a href="/" target="_blank" class="px-3 lg:px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm lg:text-base">
                            <i class="fas fa-external-link-alt mr-1 lg:mr-2"></i>
                            <span class="hidden sm:inline">웹사이트 보기</span>
                            <span class="sm:hidden">홈</span>
                        </a>
                    </div>
                </div>
            </header>

            <!-- 통계 카드 -->
            <div class="p-4 lg:p-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- 공지사항 -->
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-semibold">공지사항</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2" id="noticeCount">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-bullhorn text-blue-600 text-xl"></i>
                            </div>
                        </div>
                        <a href="/admin/notice.html" class="text-blue-600 text-sm font-semibold mt-4 inline-block hover:underline">
                            관리하기 →
                        </a>
                    </div>

                    <!-- 자료실 -->
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-semibold">자료실</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2" id="downloadCount">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-download text-green-600 text-xl"></i>
                            </div>
                        </div>
                        <a href="/admin/download.html" class="text-green-600 text-sm font-semibold mt-4 inline-block hover:underline">
                            관리하기 →
                        </a>
                    </div>

                    <!-- FAQ -->
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-semibold">FAQ</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2" id="faqCount">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-question-circle text-purple-600 text-xl"></i>
                            </div>
                        </div>
                        <a href="/admin/faq.html" class="text-purple-600 text-sm font-semibold mt-4 inline-block hover:underline">
                            관리하기 →
                        </a>
                    </div>

                    <!-- 갤러리 -->
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-pink-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm font-semibold">갤러리</p>
                                <p class="text-3xl font-bold text-gray-900 mt-2" id="galleryCount">0</p>
                            </div>
                            <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-images text-pink-600 text-xl"></i>
                            </div>
                        </div>
                        <a href="/admin/gallery.html" class="text-pink-600 text-sm font-semibold mt-4 inline-block hover:underline">
                            관리하기 →
                        </a>
                    </div>
                </div>

                <!-- 최근 활동 -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">
                        <i class="fas fa-clock text-gray-400 mr-2"></i>
                        최근 공지사항
                    </h3>
                    <div id="recentNotices" class="divide-y">
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>로딩 중...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/admin/js/auth.js"></script>
    <script>
        // 인증 확인
        checkAuth();

        // 사용자 정보 표시
        const user = JSON.parse(localStorage.getItem('adminUser') || '{}');
        document.getElementById('adminUsername').textContent = user.username || '-';

        // 모바일 사이드바 토글
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        const openBtn = document.getElementById('openSidebar');
        const closeBtn = document.getElementById('closeSidebar');

        function openSidebar() {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
        }

        function closeSidebar() {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        }

        openBtn.addEventListener('click', openSidebar);
        closeBtn.addEventListener('click', closeSidebar);
        overlay.addEventListener('click', closeSidebar);

        // 로그아웃
        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            window.location.href = '/admin/index.html';
        }

        function confirmLogout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                logout();
            }
        }

        // 통계 데이터 로드
        async function loadStats() {
            const token = localStorage.getItem('adminToken');

            try {
                // 공지사항 수
                const noticeRes = await fetch('/api/notice?limit=1', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const noticeData = await noticeRes.json();
                if (noticeData.success) {
                    document.getElementById('noticeCount').textContent = 
                        noticeData.data.pagination.total;
                }

                // 자료실 수
                const downloadRes = await fetch('/api/download?limit=1', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const downloadData = await downloadRes.json();
                if (downloadData.success) {
                    document.getElementById('downloadCount').textContent = 
                        downloadData.data.pagination.total;
                }

                // FAQ 수
                const faqRes = await fetch('/api/faq?limit=1', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const faqData = await faqRes.json();
                if (faqData.success) {
                    document.getElementById('faqCount').textContent = 
                        faqData.data.pagination.total;
                }

                // 갤러리 수
                const galleryRes = await fetch('/api/gallery?limit=1', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const galleryData = await galleryRes.json();
                if (galleryData.success) {
                    document.getElementById('galleryCount').textContent = 
                        galleryData.data.pagination.total;
                }

                // 최근 공지사항 표시
                const recentRes = await fetch('/api/notice?limit=5', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const recentData = await recentRes.json();
                if (recentData.success) {
                    displayRecentNotices(recentData.data.notices);
                }

            } catch (error) {
                console.error('Stats load error:', error);
            }
        }

        // 최근 공지사항 표시
        function displayRecentNotices(notices) {
            const container = document.getElementById('recentNotices');
            
            if (notices.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-inbox text-2xl mb-2"></i>
                        <p>등록된 공지사항이 없습니다.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = notices.map(notice => `
                <div class="py-4 flex items-center justify-between hover:bg-gray-50 px-4 -mx-4 rounded-lg transition">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900">${escapeHtml(notice.title)}</h4>
                        <p class="text-sm text-gray-500 mt-1">
                            <i class="fas fa-eye mr-1"></i>
                            조회 ${notice.views}회 · ${formatDate(notice.created_at)}
                        </p>
                    </div>
                    <a href="/admin/notice.html?id=${notice.id}" 
                       class="px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition text-sm font-semibold">
                        수정
                    </a>
                </div>
            `).join('');
        }

        // HTML 이스케이프
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 날짜 포맷
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return '방금 전';
            if (minutes < 60) return `${minutes}분 전`;
            if (hours < 24) return `${hours}시간 전`;
            if (days < 7) return `${days}일 전`;
            
            return date.toLocaleDateString('ko-KR');
        }

        // 페이지 로드 시 실행
        loadStats();
    </script>
</body>
</html>
